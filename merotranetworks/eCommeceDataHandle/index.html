<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product Entry</title>
</head>
<body>
  <h2>Product Entry Form</h2>
  <form id="productForm">
    <label>Product Name:</label>
    <input type="text" name="productName" required><br><br>

    <label>Description:</label>
    <textarea name="description"></textarea><br><br>

    <label>Supplier Name:</label>
    <input type="text" name="supplier"><br><br>

    <label>Purchase Price:</label>
    <input type="number" name="price"><br><br>

    <label>Purchase Advice:</label>
    <select name="advice">
      <option value="Final">Final</option>
      <option value="Pending">Pending</option>
    </select><br><br>

    <label>Remarks:</label>
    <input type="text" name="remarks"><br><br>

    <label>Attach Photos:</label>
    <div id="imageInputs">
      <input type="file" name="images[]"><br>
    </div>
    <button type="button" id="addImage">Add Image</button><br><br>

    <button type="submit">Submit</button>
  </form>

  <p id="status"></p>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbxHUN2rmMMy7kpn8fpcqOX9V0Xy-xZJe82NrTHtr1pYJAcYODYSu2F2_nVthnFGc1zcAQ/exec"; // <-- replace if needed

    let imageCount = 1;
    document.getElementById("addImage").addEventListener("click", (e) => {
      if (imageCount < 8) {
        const input = document.createElement("input");
        input.type = "file";
        input.name = "images[]";
        document.getElementById("imageInputs").appendChild(input);
        document.getElementById("imageInputs").appendChild(document.createElement("br"));
        imageCount++;
      } else {
        alert("Maximum 8 images allowed.");
      }
    });

    document.getElementById("productForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;

      const imageInputs = document.querySelectorAll('input[name="images[]"]');
      let base64Images = [];
      for (let input of imageInputs) {
        if (input.files.length > 0) {
          let file = input.files[0];
          let reader = new FileReader();
          base64Images.push(await new Promise(resolve => {
            reader.onload = () => resolve(reader.result);
            reader.readAsDataURL(file);
          }));
        }
      }

      const data = {
        productName: form.productName.value,
        description: form.description.value,
        supplier: form.supplier.value,
        price: form.price.value,
        advice: form.advice.value,
        remarks: form.remarks.value,
        images: base64Images
      };

      document.getElementById("status").innerText = "Submitting...";

      fetch(scriptURL, {
        method: "POST",
        mode: "no-cors",
        body: JSON.stringify(data),
        headers: {"Content-Type": "text/plain"}
      })
      .then(() => {
        document.getElementById("status").innerText = "✅ Submitted successfully!";
        form.reset();
      })
      .catch(err => {
        document.getElementById("status").innerText = "❌ Error: " + err;
      });
    });
  </script>
</body>
</html>
